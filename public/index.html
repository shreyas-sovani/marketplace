<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üè¶ AgentPay Pro - Live Revenue Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;700;900&display=swap');
    
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%);
      min-height: 100vh;
    }
    
    .mono { font-family: 'JetBrains Mono', monospace; }
    
    /* Glow effects */
    .glow-green {
      text-shadow: 0 0 20px #22c55e, 0 0 40px #22c55e, 0 0 60px #22c55e;
    }
    
    .glow-box {
      box-shadow: 0 0 30px rgba(34, 197, 94, 0.3), inset 0 0 30px rgba(34, 197, 94, 0.1);
    }
    
    .glow-pulse {
      animation: pulse-glow 2s ease-in-out infinite;
    }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.4); }
      50% { box-shadow: 0 0 40px rgba(34, 197, 94, 0.8); }
    }
    
    /* Transaction entry animation */
    .tx-enter {
      animation: slideIn 0.5s ease-out, glowFade 2s ease-out;
    }
    
    @keyframes slideIn {
      from { transform: translateX(-100px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes glowFade {
      0% { background: rgba(34, 197, 94, 0.4); }
      100% { background: rgba(34, 197, 94, 0.05); }
    }
    
    /* Number counter animation */
    .revenue-update {
      animation: popNumber 0.3s ease-out;
    }
    
    @keyframes popNumber {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); color: #4ade80; }
      100% { transform: scale(1); }
    }
    
    /* Scrollbar styling */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #1a1a2e; }
    ::-webkit-scrollbar-thumb { background: #22c55e; border-radius: 4px; }
    
    /* Grid pattern background */
    .grid-bg {
      background-image: 
        linear-gradient(rgba(34, 197, 94, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(34, 197, 94, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
    }
  </style>
</head>
<body class="grid-bg text-white">
  <!-- Header -->
  <header class="border-b border-green-500/20 bg-black/50 backdrop-blur-sm sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-3 h-3 bg-green-500 rounded-full glow-pulse"></div>
        <h1 class="text-xl font-bold">üè¶ AgentPay Pro</h1>
        <span class="text-green-500/60 text-sm">LIVE</span>
      </div>
      <div class="flex items-center gap-6 text-sm text-gray-400">
        <span class="mono">x402 v2</span>
        <span class="mono">eip155:84532</span>
        <span id="connection-status" class="flex items-center gap-2">
          <span class="w-2 h-2 bg-yellow-500 rounded-full"></span>
          Connecting...
        </span>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-6 py-12">
    <!-- Hero Revenue Section -->
    <section class="text-center mb-16">
      <p class="text-green-500/60 text-lg mb-4 tracking-widest uppercase">Protocol Revenue</p>
      <div class="glow-box rounded-3xl bg-black/40 border border-green-500/30 p-12 inline-block">
        <h2 id="revenue" class="text-8xl md:text-9xl font-black mono glow-green">
          $0.00
        </h2>
      </div>
      <div class="mt-8 flex justify-center gap-12">
        <div class="text-center">
          <p id="tx-count" class="text-4xl font-bold mono text-green-400">0</p>
          <p class="text-gray-500 text-sm uppercase tracking-wider">Transactions</p>
        </div>
        <div class="text-center">
          <p id="avg-price" class="text-4xl font-bold mono text-green-400">$0.01</p>
          <p class="text-gray-500 text-sm uppercase tracking-wider">Per Request</p>
        </div>
        <div class="text-center">
          <p id="agents-count" class="text-4xl font-bold mono text-green-400">0</p>
          <p class="text-gray-500 text-sm uppercase tracking-wider">Unique Agents</p>
        </div>
      </div>
    </section>

    <!-- Live Activity Feed -->
    <section>
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold flex items-center gap-3">
          <span class="w-2 h-2 bg-green-500 rounded-full animate-ping"></span>
          Live Agent Activity
        </h3>
        <span class="text-gray-500 text-sm mono">Real-time via Socket.io</span>
      </div>
      
      <div id="tx-feed" class="space-y-3 max-h-[500px] overflow-y-auto pr-2">
        <!-- Transactions will be inserted here -->
        <div class="text-center py-12 text-gray-600">
          <p class="text-4xl mb-4">ü§ñ</p>
          <p>Waiting for AI agents to make purchases...</p>
          <p class="text-sm mt-2 mono">Run: npm run start:agent</p>
        </div>
      </div>
    </section>

    <!-- How It Works -->
    <section class="mt-16 border-t border-green-500/20 pt-12">
      <h3 class="text-xl font-bold mb-6 text-center text-gray-400">How x402 Works</h3>
      <div class="grid md:grid-cols-4 gap-6 text-center">
        <div class="bg-black/30 rounded-xl p-6 border border-green-500/10">
          <div class="text-3xl mb-3">ü§ñ</div>
          <p class="font-semibold mb-2">1. Agent Requests</p>
          <p class="text-sm text-gray-500">AI agent calls /premium-alpha</p>
        </div>
        <div class="bg-black/30 rounded-xl p-6 border border-green-500/10">
          <div class="text-3xl mb-3">üí≥</div>
          <p class="font-semibold mb-2">2. 402 Response</p>
          <p class="text-sm text-gray-500">Server returns payment required</p>
        </div>
        <div class="bg-black/30 rounded-xl p-6 border border-green-500/10">
          <div class="text-3xl mb-3">‚úçÔ∏è</div>
          <p class="font-semibold mb-2">3. Agent Signs</p>
          <p class="text-sm text-gray-500">USDC payment via PAYMENT-SIGNATURE</p>
        </div>
        <div class="bg-black/30 rounded-xl p-6 border border-green-500/10">
          <div class="text-3xl mb-3">‚úÖ</div>
          <p class="font-semibold mb-2">4. Data Delivered</p>
          <p class="text-sm text-gray-500">Premium alpha returned instantly</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="border-t border-green-500/20 mt-12 py-6 text-center text-gray-600 text-sm">
    <p>AgentPay Pro ‚Ä¢ x402 v2 Protocol ‚Ä¢ Base Sepolia Testnet</p>
    <p class="mono mt-1">Built for the future of AI commerce üöÄ</p>
  </footer>

  <!-- Audio for cha-ching sound (optional) -->
  <audio id="cha-ching" preload="auto">
    <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdH2IkI2LiYSAenVyc3d7goaHiYmJh4WDgH16d3V0dHZ4e36Ag4WHiIiIh4WDgX56d3RycnR2eX2AhIaIiYmIh4WCf3x4dXJxcnR3en6BhYeJiYmIhoSBfnp3dHFwcnR3en6ChYiJiomIhoOAfXl2c3BvcXR3en+ChoeJiomIhoOAfXl2c3BvcXR3e3+ChoeKiomIhoN/fHh1cnBvcXR4e3+ChoeKiomIhYJ/fHh1cnBvcXR4fICDh4qKiomHhIJ+e3d0cW9wcnV5fICEh4qKiomHhIF+e3d0cW9wcnV5fYGEiIqKiomGhIF9end0cXBwc3Z5fYGFiIqLiomGg4B9eXZ0cXBwc3Z6fYGFiIuLiomGg399eXZ0cXBwc3Z6fYKFiYuLiomGg399eXZ0cXBwc3Z6foKGiYuLiomGg399eXV0cXBwc3d6foKGiYyLiomFgn98eHV0cXBxc3d7foOGiYyLiomFgn98eHV0cXBxdHd7f4OHioyLiYmFgn57eHV0cXFxdHh7f4OHi4yLiYmFgX57eHV0cnFxdHh8gISHi4yLiYmEgX57eHV1cnFydXh8gIWIi4yLiYiFgX57eHZ1cnFydXl8gIWIjIyLiYiFgH57eHZ1c3Fydnl9gYWJjIyLiYiEgH57eHZ2c3Jydn19gYaJjIyLiYiEgH56eHZ2c3Jzdnl9goaJjI2LiYiDf3x6eHZ2dHJzdnp+goaKjI2LiIiDf3x6eHd2dHNzdnp+g4eKjI2LiIiDfnx6eXd3dHNzd3p/g4eKjY2LiIeCfnx6eXd3dXN0d3uAhIeLjY2LiIeCfnt6eXh3dXN0eHuAhIiLjY2Lh4eCfXt6eXh4dXR0eHyBhYiMjY2Lh4eBfXt6enh4dnR1eHyBhYmMjo2Lh4eBfXt7e3h5dnV1eX2ChomMjo2Kh4eBfHt7e3l5d3V2eX2ChomNjo2Kh4aAfHt7fHl6d3Z2en6DhomNjo6Kh4aAfHt8fHp6eHZ3en6Eh4qNj46Kh4V/e3t8fHp7eHd3e3+EiIqOj46JhoV/ent8fXt7eXd4e3+FiIuOj46Jh4R+ent9fXt8eXh4fICFiYuPkI6Jh4R+eXt9fXx8enh5fICGiYyPkI6Ih4R9eXt+fnx9e3l5fYGGio2QkI6Ih4N9eXp+fn19e3p6fYGHio2QkY6IhoN8eHp/f31+fHp6foKHi46RkY6IhoJ8eHqAf35+fHt7foKIi4+RkY6HhYJ7d3mAgH9/fXt7f4OIjI+SkY6HhYF7d3mBgYB/fnt8f4OJjJCSkY6GhIF6dniCgoGAfnx8gIOJjZCTko6GhIB5dXiCg4KBf318gYSKjpGTko2FhH95dXeDhIKCgH59gYSKjpGUko2FhH94dHaEhYODgX9+goWLj5KUko2EgoB3c3WFhoSEgoB+goaMj5OVko2DgX92c3SGh4WFg4F/g4aNkJOVkoyDgX91cnOHiIaGhIKAhIeOkZSWkoyDgH50cXKIioeHhYOBhYiOkpWWkouCf351cHGJi4iIh4WDhoqPk5aXkomBfn10b3CKjImJiIaEh4uQlJeXkYqAe3xzbm+LjYqKiYeGiI2RlZiYkYl/entzb2+Mj4yLi4mIiY6SlpmZkYl+eXpya2yNkI6NjIqJi5CUmJqakIh9eHlxamqOko+PjoyLjJGVmZubkIZ7dndwZ2iQlJGRj42Mj5SXm5yckIV5dXVuZWWRlpOTkY+OkZaZnZ6dj4R3cnNsY2KTmJWVk5GQk5ibo5+fjoJzbG9qXl6VmpqXl5SSlpqeoaGhj4FwamxoWFmXnpyal5aUmJygoqOjjn5tamdhUlOZoJ2cm5mXm56io6Wljnppa2VdTU+bop+fnpuanqGkpaemjHZkZmJYR0ien6Ggn52coKOmqKmph3JfYl1SPj6goqOjoaCeoqWoq6yrhG1ZXlhKNDOjpaampqKhpainq62thWpVWVVFLCulqKmqqaako6qprK+wrYVmUVVQQSUjqKusraylpKWsr6+xsbCEYk1RTz0hHqutrrCupqOnrrGytrWxgV1IRkw5Gxetr7GzsKmmqbGztre5t7N9VkJERjQUEq+ytbe0q6irtre5uru7uHlPPEBCMBEOsbW4urauq6+5ur2+v7+7dkg4PD8tDgizt7u+vLKvsry+wMHCw8G3bUExOTsoDQW2ury/v7ayuMDCxMXGxsS1ZDosNDglCgO4vL/Cwr61vMPFx8nJycfAX0MpLjMgBwG5vsHEw8C5v8bIy8zMzcvHUzshLC8aBQC8wcPHxsK9xMrM0NDR0M/MYT0aIy0XAgC+xMbKycXCyc/S1dbX1tbTiDMUHCcRAADBx8nOzcnHzdTY2tzc3NvZtysRGiMNAADEy87S0c3Mz9XZ3eDh4eDf5TgOFB8JAADH0NLW1dHR1Nnc3+Hj4+Lh" type="audio/wav">
  </audio>

  <script>
    // ==========================================================================
    // üîå SOCKET.IO CONNECTION
    // ==========================================================================
    const socket = io();
    
    // DOM elements
    const revenueEl = document.getElementById('revenue');
    const txCountEl = document.getElementById('tx-count');
    const agentsCountEl = document.getElementById('agents-count');
    const txFeedEl = document.getElementById('tx-feed');
    const connectionStatusEl = document.getElementById('connection-status');
    const chaChing = document.getElementById('cha-ching');
    
    // Track unique agents
    const uniqueAgents = new Set();
    
    // ==========================================================================
    // üìä UPDATE FUNCTIONS
    // ==========================================================================
    
    function updateRevenue(amount) {
      revenueEl.textContent = `$${amount.toFixed(2)}`;
      revenueEl.classList.add('revenue-update');
      setTimeout(() => revenueEl.classList.remove('revenue-update'), 300);
    }
    
    function updateTxCount(count) {
      txCountEl.textContent = count;
    }
    
    function updateAgentsCount() {
      agentsCountEl.textContent = uniqueAgents.size;
    }
    
    function addTransaction(tx) {
      // Remove placeholder if exists
      const placeholder = txFeedEl.querySelector('.text-center');
      if (placeholder) placeholder.remove();
      
      // Create transaction element
      const txEl = document.createElement('div');
      txEl.className = 'tx-enter bg-green-500/5 border border-green-500/20 rounded-xl p-4 flex items-center justify-between';
      
      const shortAgent = tx.agent.slice(0, 6) + '...' + tx.agent.slice(-4);
      const shortTx = tx.tx.slice(0, 10) + '...';
      const time = new Date(tx.timestamp).toLocaleTimeString();
      
      txEl.innerHTML = `
        <div class="flex items-center gap-4">
          <div class="w-10 h-10 bg-green-500/20 rounded-full flex items-center justify-center text-xl">
            ü§ñ
          </div>
          <div>
            <p class="font-semibold">Agent <span class="mono text-green-400">${shortAgent}</span></p>
            <p class="text-sm text-gray-500">Purchased premium alpha</p>
          </div>
        </div>
        <div class="text-right">
          <p class="text-green-400 font-bold text-xl">+$${tx.amount.toFixed(2)}</p>
          <a href="https://sepolia.basescan.org/tx/${tx.tx}" target="_blank" 
             class="text-xs mono text-gray-500 hover:text-green-400 transition">
            ${shortTx} ‚Üó
          </a>
        </div>
      `;
      
      // Prepend to feed
      txFeedEl.prepend(txEl);
      
      // Keep only last 50 in DOM
      while (txFeedEl.children.length > 50) {
        txFeedEl.removeChild(txFeedEl.lastChild);
      }
    }
    
    function playSound() {
      try {
        chaChing.currentTime = 0;
        chaChing.play().catch(() => {}); // Ignore autoplay errors
      } catch {}
    }
    
    // ==========================================================================
    // üîå SOCKET EVENT HANDLERS
    // ==========================================================================
    
    socket.on('connect', () => {
      console.log('‚úÖ Connected to AgentPay Pro server');
      connectionStatusEl.innerHTML = `
        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
        Connected
      `;
    });
    
    socket.on('disconnect', () => {
      console.log('‚ùå Disconnected from server');
      connectionStatusEl.innerHTML = `
        <span class="w-2 h-2 bg-red-500 rounded-full"></span>
        Disconnected
      `;
    });
    
    // Initial data load
    socket.on('init', (data) => {
      console.log('üìä Received initial data:', data);
      updateRevenue(data.revenue);
      updateTxCount(data.txCount);
      
      // Load existing transactions
      data.recentTransactions.forEach(tx => {
        uniqueAgents.add(tx.agent);
        addTransaction(tx);
      });
      updateAgentsCount();
    });
    
    // New sale event
    socket.on('new-sale', (data) => {
      console.log('üí∞ NEW SALE:', data);
      
      // Play sound
      playSound();
      
      // Update stats
      updateRevenue(data.totalRevenue);
      updateTxCount(data.txCount);
      
      // Track unique agent
      uniqueAgents.add(data.agent);
      updateAgentsCount();
      
      // Add to feed
      addTransaction({
        amount: data.amount,
        agent: data.agent,
        tx: data.tx,
        timestamp: data.timestamp,
      });
    });
    
    // ==========================================================================
    // üöÄ INITIAL LOAD
    // ==========================================================================
    
    // Fetch initial stats on page load
    fetch('/stats')
      .then(res => res.json())
      .then(data => {
        updateRevenue(data.revenue);
        updateTxCount(data.txCount);
        data.recentTransactions.forEach(tx => {
          uniqueAgents.add(tx.agent);
        });
        updateAgentsCount();
      })
      .catch(err => console.error('Failed to fetch stats:', err));
  </script>
</body>
</html>
